- name: Install apt packages
  become: true
  ansible.builtin.package:
    state: present
    name:
      - ark
      - entr
      - gimp
      - gnome-shell-extension-manager
      - htop
      - inkscape
      - kdenlive
      - keepassxc
      - kernelstub
      - lutris
      - nala
      - neofetch
      - nmap
      - nodejs
      - nvtop
      - okular
      - pip
      - powertop
      - steam
      - timeshift
      - tmux
      - virt-manager
      - xournalpp

- name: install GitKraken
  become: true
  ansible.builtin.package:
    deb:
      "https://release.gitkraken.com/linux/gitkraken-amd64.deb"

- name: Install Vesktop flatpak
  community.general.flatpak:
    method: user
    state: present
    name: dev.vencord.Vesktop

- name: Install MMEX flatpak
  community.general.flatpak:
    method: user
    state: present
    name: org.moneymanagerex.MMEX

- name: Install Prism Launcher flatpak
  community.general.flatpak:
    method: user
    state: present
    name: org.prismlauncher.PrismLauncher

- name: Install pip packages
  ansible.builtin.pip:
    state: latest
    name:
      - pyautogui

- name: Check the number of nala sources
  ansible.builtin.shell: cat /etc/apt/sources.list.d/nala-sources.list | grep -c "deb"
  register: nala_sources
  changed_when: false
  args:
    # Only runs when the nala sources file exists
    removes: /etc/apt/sources.list.d/nala-sources.list

- name: Run nala fetch
  ansible.builtin.shell:
    cmd: echo "y" | sudo nala fetch --auto --fetches 16
  when: nala_sources.stdout | int < 16